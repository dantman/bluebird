/* @preserve
 * The MIT License (MIT)
 * 
 * Copyright (c) 2014 Petka Antonov
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:</p>
 * 
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 * 
 */
/**
 * bluebird build version 2.9.11
 * Features enabled: core, race, call_get, generators, map, nodeify, promisify, props, reduce, settle, some, cancel, using, filter, any, each, timers
*/
!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.Promise=t()}}(function(){var t,e,r;return function n(t,e,r){function i(s,a){if(!e[s]){if(!t[s]){var c="function"==typeof _dereq_&&_dereq_;if(!a&&c)return c(s,!0);if(o)return o(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var l=e[s]={exports:{}};t[s][0].call(l.exports,function(e){var r=t[s][1][e];return i(r?r:e)},l,l.exports,n,t,e,r)}return e[s].exports}for(var o="function"==typeof _dereq_&&_dereq_,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(t,e){"use strict";e.exports=function(t){function e(t){var e=new r(t),n=e.promise();return e.setHowMany(1),e.setUnwrap(),e.init(),n}var r=t._SomePromiseArray;t.any=function(t){return e(t)},t.prototype.any=function(){return e(this)}}},{}],2:[function(t,e){"use strict";function r(){this._isTickUsed=!1,this._lateQueue=new s(16),this._normalQueue=new s(16),this._haveDrainedQueues=!1;var t=this;this.drainQueues=function(){t._drainQueues()},this._schedule=o.isStatic?o(this.drainQueues):o}var n;try{throw new Error}catch(i){n=i}var o=t("./schedule.js"),s=t("./queue.js");r.prototype.haveItemsQueued=function(){return this._isTickUsed||this._haveDrainedQueues},r.prototype.fatalError=function(t,e){e?(process.stderr.write("Fatal "+(t instanceof Error?t.stack:t)),process.exit(2)):this.throwLater(t)},r.prototype.throwLater=function(t,e){if(1===arguments.length&&(e=t,t=function(){throw e}),"undefined"!=typeof setTimeout)setTimeout(function(){t(e)},0);else try{this._schedule(function(){t(e)})}catch(r){throw new Error("No async scheduler available\n\n    See http://goo.gl/m3OTXk\n")}},r.prototype.invokeLater=function(t,e,r){this._lateQueue.push(t,e,r),this._queueTick()},r.prototype.invokeFirst=function(t,e,r){this._normalQueue.unshift(t,e,r),this._queueTick()},r.prototype.invoke=function(t,e,r){this._normalQueue.push(t,e,r),this._queueTick()},r.prototype.settlePromises=function(t){this._normalQueue._pushOne(t),this._queueTick()},r.prototype._drainQueue=function(t){for(;t.length()>0;){var e=t.shift();if("function"==typeof e){var r=t.shift(),n=t.shift();e.call(r,n)}else e._settlePromises()}},r.prototype._drainQueues=function(){this._drainQueue(this._normalQueue),this._reset(),this._haveDrainedQueues=!0,this._drainQueue(this._lateQueue)},r.prototype._queueTick=function(){this._isTickUsed||(this._isTickUsed=!0,this._schedule(this.drainQueues))},r.prototype._reset=function(){this._isTickUsed=!1},e.exports=r,e.exports.firstLineError=n},{"./queue.js":26,"./schedule.js":29}],3:[function(t,e){"use strict";e.exports=function(t,e,r,n){var i=!1,o=function(t,e){this._reject(e)},s=function(t,e){e.promiseRejectionQueued=!0,e.bindingPromise._then(o,o,null,this,t)},a=function(t,e){this._setBoundTo(t),0===(50397184&this._bitField)&&this._resolveCallback(e.target)},c=function(t,e){e.promiseRejectionQueued||this._reject(t)};t.prototype.bind=function(o){i||(i=!0,t.prototype._propagateFrom=n.propagateFromFunction());var u=r(o),l=new t(e);l._propagateFrom(this,1);var h=this._target();if(u instanceof t){var p={promiseRejectionQueued:!1,promise:l,target:h,bindingPromise:u};h._then(e,s,l._progress,l,p),u._then(a,c,l._progress,l,p)}else l._setBoundTo(o),l._resolveCallback(h);return l},t.prototype._setBoundTo=function(t){void 0!==t?(this._bitField=2097152|this._bitField,this._boundTo=t):this._bitField=-2097153&this._bitField},t.prototype._isBound=function(){return 2097152===(2097152&this._bitField)},t.bind=function(e,r){return t.resolve(r).bind(e)}}},{}],4:[function(t,e){"use strict";function r(){try{Promise===i&&(Promise=n)}catch(t){}return i}var n;"undefined"!=typeof Promise&&(n=Promise);var i=t("./promise.js")();i.noConflict=r,e.exports=i},{"./promise.js":22}],5:[function(t,e){"use strict";var r=Object.create;if(r){var n=r(null),i=r(null);n[" size"]=i[" size"]=0}e.exports=function(e){function r(t,r){var n;if(null!=t&&(n=t[r]),"function"!=typeof n){var i="Object "+a.classString(t)+" has no method '"+a.toString(r)+"'";throw new e.TypeError(i)}return n}function n(t){var e=this.pop(),n=r(t,e);return n.apply(t,this)}function i(t){return t[this]}function o(t){var e=+this;return 0>e&&(e=Math.max(0,e+t.length)),t[e]}{var s,a=t("./util.js"),c=a.canEvaluate;a.isIdentifier}e.prototype.call=function(t){var e=[].slice.call(arguments,1);return e.push(t),this._then(n,void 0,void 0,e,void 0)},e.prototype.get=function(t){var e,r="number"==typeof t;if(r)e=o;else if(c){var n=s(t);e=null!==n?n:i}else e=i;return this._then(e,void 0,void 0,t,void 0)}}},{"./util.js":36}],6:[function(t,e){"use strict";e.exports=function(e,r,n){var i=t("./util.js"),o=i.tryCatch,s=i.errorObj,a=e._async;e.prototype._cancel=function(){this.isCancellable()&&(this._setCancelled(),this._cleanValues(),this._length()>0&&a.invoke(this._cancelPromises,this,void 0))},e.prototype._cancelPromises=function(){this._length()>0&&this._settlePromises()},e.prototype._unsetOnCancel=function(){this._onCancelField=void 0},e.prototype._setOnCancel=function(t){this._onCancelField=t},e.prototype._onCancel=function(){return this._onCancelField},e.prototype.isCancellable=function(){return this.isPending()&&!this.isCancelled()},e.prototype._attachCancellationCallback=function(t,e){if(!this.isCancellable())return this.isCancelled()&&a.invoke(this._invokeOnCancel,this,t),this;var r=this._target();if(void 0!==r._onCancel()){var n=t,i=r._onCancel();void 0===e&&(e=this),t=function(){e._invokeOnCancel(i),e._invokeOnCancel(n),r._unsetOnCancel()}}r._setOnCancel(t)},e.prototype.onCancel=function(t){return"function"!=typeof t?r("onCancel must be a function, got: "+i.toString(t)):(this._attachCancellationCallback(t),this)},e.prototype._doInvokeOnCancel=function(t){if(void 0!==t){if("function"==typeof t){var r=o(t).call(this._boundTo);r===s&&(this._attachExtraTrace(r.e),a.throwLater(r.e))}else t instanceof e?t.cancel():t._resultCancelled(this);this._unsetOnCancel()}},e.prototype._invokeOnCancel=function(t){a.invoke(this._doInvokeOnCancel,this,t)},e.prototype.cancelAfter=function(t){var e=this;setTimeout(function(){e.cancel()},t)},e.prototype["break"]=e.prototype.cancel=function(){if(!n.cancellation())return this._warn("cancellation is disabled");for(var t=this;t.isCancellable();){t._invokeOnCancel(t._onCancel());var e=t._cancellationParent;if(null==e||!e.isCancellable()){t._isFollowing()?t._followee().cancel():t._cancel();break}t._isFollowing()&&t._followee().cancel(),t=e}}}},{"./util.js":36}],7:[function(t,e){"use strict";e.exports=function(e){function r(t,r,a){return function(c){var u=a._boundTo;t:for(var l=0;l<t.length;++l){var h=t[l];if(h===Error||null!=h&&h.prototype instanceof Error){if(c instanceof h)return o(r).call(u,c)}else if("function"==typeof h){var p=o(h).call(u,c);if(p===s)return p;if(p)return o(r).call(u,c)}else if(n.isObject(c)){for(var f=i(h),_=0;_<f.length;++_){var d=f[_];if(h[d]!=c[d])continue t}return o(r).call(u,c)}}return e}}var n=t("./util.js"),i=t("./es5.js").keys,o=n.tryCatch,s=n.errorObj;return r}},{"./es5.js":13,"./util.js":36}],8:[function(t,e){"use strict";e.exports=function(t){function e(){this._trace=new e.CapturedTrace(n())}function r(){return i?new e:void 0}function n(){var t=o.length-1;return t>=0?o[t]:void 0}var i=!1,o=[];return t.prototype._promiseCreated=function(){},t.prototype._pushContext=function(){},t.prototype._popContext=function(){return 0},t._peekContext=t.prototype._peekContext=function(){},e.prototype._pushContext=function(){void 0!==this._trace&&(this._trace._promisesCreated=0,o.push(this._trace))},e.prototype._popContext=function(){if(void 0!==this._trace){var t=o.pop(),e=t._promisesCreated;return t._promisesCreated=0,e}return 0},e.CapturedTrace=null,e.create=r,e.activateLongStackTraces=function(){i=!0,t.prototype._pushContext=e.prototype._pushContext,t.prototype._popContext=e.prototype._popContext,t._peekContext=t.prototype._peekContext=n,t.prototype._promiseCreated=function(){var t=this._peekContext();t&&t._promisesCreated++}},e}},{}],9:[function(t,e){"use strict";e.exports=function(e,r){function n(){this._cancellationParent=void 0}function i(t,e){0!==(1&e)&&(this._cancellationParent=t),0!==(2&e)&&t._isBound()&&this._setBoundTo(t._boundTo)}function o(t,e){0!==(2&e)&&t._isBound()&&this._setBoundTo(t._boundTo)}function s(){this._trace=new k(this._peekContext())}function a(t,e){if(S(t)){var r=this._trace;if(void 0!==r&&e&&(r=r._parent),void 0!==r)r.attachExtraTrace(t);else if(!t.__stackCleaned__){var n=v(t);t.stack=n.message+"\n"+n.stack.join("\n"),P.notEnumerableProp(t,"__stackCleaned__",!0)}}}function c(t,e,r,n){if(void 0===t&&e>0&&q.longStackTraces&&q.warnings){var i="a promise was created in a "+r+" handler but was not returned from it";n._warn(i)}}function u(t,e){var r=t+" is deprecated and will be removed in a future version.";return e&&(r+=" Use "+e+" instead."),l(r)}function l(t,r,n){if(q.warnings){var i,o=new O(t);if(r)n._attachExtraTrace(o);else if(q.longStackTraces&&(i=e._peekContext()))i.attachExtraTrace(o);else{var s=v(o);o.stack=s.message+"\n"+s.stack.join("\n")}y(o,"",!0)}}function h(t,e){for(var r=0;r<e.length-1;++r)e[r].push("From previous event:"),e[r]=e[r].join("\n");return r<e.length&&(e[r]=e[r].join("\n")),t+"\n"+e.join("\n")}function p(t){for(var e=0;e<t.length;++e)(0===t[e].length||e+1<t.length&&t[e][0]===t[e+1][0])&&(t.splice(e,1),e--)}function f(t){for(var e=t[0],r=1;r<t.length;++r){for(var n=t[r],i=e.length-1,o=e[i],s=-1,a=n.length-1;a>=0;--a)if(n[a]===o){s=a;break}for(var a=s;a>=0;--a){var c=n[a];if(e[i]!==c)break;e.pop(),i--}e=n}}function _(t){for(var e=[],r=0;r<t.length;++r){var n=t[r],i=A.test(n)||"    (No stack trace)"===n,o=i&&N(n);i&&!o&&(V&&" "!==n.charAt(0)&&(n="    "+n),e.push(n))}return e}function d(t){for(var e=t.stack.replace(/\s+$/g,"").split("\n"),r=0;r<e.length;++r){var n=e[r];if("    (No stack trace)"===n||A.test(n))break}return r>0&&(e=e.slice(r)),e}function v(t){var e=t.stack,r=t.toString();return e="string"==typeof e&&e.length>0?d(t):["    (No stack trace)"],{message:r,stack:_(e)}}function y(t,e,r){if("undefined"!=typeof console){var n;if(P.isObject(t)){var i=t.stack;n=e+D(i,t)}else n=e+String(t);"function"==typeof x?x(n,r):("function"==typeof console.log||"object"==typeof console.log)&&console.log(n)}}function g(t,e,r,n){var i=!1;try{"function"==typeof e&&(i=!0,"rejectionHandled"===t?e(n):e(r,n))}catch(o){T.throwLater(o)}var s=!1;try{s=M(t,r,n)}catch(o){s=!0,T.throwLater(o)}var a=!1;if(Q)try{a=Q(t.toLowerCase(),{reason:r,promise:n})}catch(o){a=!0,T.throwLater(o)}s||i||a||"unhandledRejection"!==t||y(r,"Unhandled rejection ")}function m(t){var e;if("function"==typeof t)e="[function "+(t.name||"anonymous")+"]";else{e=t&&"function"==typeof t.toString?t.toString():P.toString(t);var r=/\[object [a-zA-Z0-9$_]+\]/;if(r.test(e))try{var n=JSON.stringify(t);e=n}catch(i){}0===e.length&&(e="(empty array)")}return"(<"+j(e)+">, no stack trace)"}function j(t){var e=41;return t.length<e?t:t.substr(0,e-3)+"..."}function b(){return"function"==typeof $}function w(t){var e=t.match(B);return e?{fileName:e[1],line:parseInt(e[2],10)}:void 0}function C(t,e){if(b()){for(var r,n,i=t.stack.split("\n"),o=e.stack.split("\n"),s=-1,a=-1,c=0;c<i.length;++c){var u=w(i[c]);if(u){r=u.fileName,s=u.line;break}}for(var c=0;c<o.length;++c){var u=w(o[c]);if(u){n=u.fileName,a=u.line;break}}0>s||0>a||!r||!n||r!==n||s>=a||(N=function(t){if(R.test(t))return!0;var e=w(t);return e&&e.fileName===r&&s<=e.line&&e.line<=a?!0:!1})}}function k(t){this._parent=t,this._promisesCreated=0;var e=this._length=1+(void 0===t?0:t._length);$(this,k),e>32&&this.uncycle()}var E,F,x,T=e._async,O=t("./errors.js").Warning,P=t("./util.js"),S=P.canAttachTrace,R=/[\\\/]bluebird[\\\/]js[\\\/](release|debug|instrumented)/,A=null,D=null,V=!1,L=!(!P.env("BLUEBIRD_DEBUG")&&"development"!==P.env("NODE_ENV")),I=!(0==P.env("BLUEBIRD_WARNINGS")||!L&&!P.env("BLUEBIRD_WARNINGS")),U=!(0==P.env("BLUEBIRD_LONG_STACK_TRACES")||!L&&!P.env("BLUEBIRD_LONG_STACK_TRACES"));e.prototype._ensurePossibleRejectionHandled=function(){this._setRejectionIsUnhandled(),T.invokeLater(this._notifyUnhandledRejection,this,void 0)},e.prototype._notifyUnhandledRejectionIsHandled=function(){g("rejectionHandled",E,void 0,this)},e.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var t=this._settledValue();this._setUnhandledRejectionIsNotified(),g("unhandledRejection",F,t,this)}},e.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=262144|this._bitField},e.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=-262145&this._bitField},e.prototype._isUnhandledRejectionNotified=function(){return(262144&this._bitField)>0},e.prototype._setRejectionIsUnhandled=function(){this._bitField=1048576|this._bitField},e.prototype._unsetRejectionIsUnhandled=function(){this._bitField=-1048577&this._bitField,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},e.prototype._isRejectionUnhandled=function(){return(1048576&this._bitField)>0},e.prototype._warn=function(t,e){return l(t,e,this)},e.onPossiblyUnhandledRejection=function(t){F="function"==typeof t?t:void 0},e.onUnhandledRejectionHandled=function(t){E="function"==typeof t?t:void 0},e.longStackTraces=function(){if(T.haveItemsQueued()&&!q.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/DT1qyG\n");!q.longStackTraces&&b()&&(q.longStackTraces=!0,e.prototype._captureStackTrace=s,e.prototype._attachExtraTrace=a,r.activateLongStackTraces())},e.hasLongStackTraces=function(){return q.longStackTraces&&b()},e.config=function(t){if(t=Object(t),"longStackTraces"in t&&t.longStackTraces&&e.longStackTraces(),"warnings"in t&&(q.warnings=!!t.warnings),"cancellation"in t&&t.cancellation&&!q.cancellation){if(T.haveItemsQueued())throw new Error("cannot enable cancellation after promises are in use");e.prototype._cleanValues=n,e.prototype._propagateFrom=i,H=i,q.cancellation=!0}},e.prototype._captureStackTrace=function(){},e.prototype._attachExtraTrace=function(){},e.prototype._cleanValues=function(){},e.prototype._propagateFrom=function(){};var H=o,N=function(){return!1},B=/[\/<\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/;P.inherits(k,Error),r.CapturedTrace=k,k.prototype.uncycle=function(){var t=this._length;if(!(2>t)){for(var e=[],r={},n=0,i=this;void 0!==i;++n)e.push(i),i=i._parent;t=this._length=n;for(var n=t-1;n>=0;--n){var o=e[n].stack;void 0===r[o]&&(r[o]=n)}for(var n=0;t>n;++n){var s=e[n].stack,a=r[s];if(void 0!==a&&a!==n){a>0&&(e[a-1]._parent=void 0,e[a-1]._length=1),e[n]._parent=void 0,e[n]._length=1;var c=n>0?e[n-1]:this;t-1>a?(c._parent=e[a+1],c._parent.uncycle(),c._length=c._parent._length+1):(c._parent=void 0,c._length=1);for(var u=c._length+1,l=n-2;l>=0;--l)e[l]._length=u,u++;return}}}},k.prototype.attachExtraTrace=function(t){if(!t.__stackCleaned__){this.uncycle();for(var e=v(t),r=e.message,n=[e.stack],i=this;void 0!==i;)n.push(_(i.stack.split("\n"))),i=i._parent;f(n),p(n),t.stack=h(r,n),P.notEnumerableProp(t,"__stackCleaned__",!0)}};var Q,$=function(){var t=/^\s*at\s*/,e=function(t,e){return"string"==typeof t?t:void 0!==e.name&&void 0!==e.message?e.toString():m(e)};if("number"==typeof Error.stackTraceLimit&&"function"==typeof Error.captureStackTrace){Error.stackTraceLimit=Error.stackTraceLimit+6,A=t,D=e;var r=Error.captureStackTrace;return N=function(t){return R.test(t)},function(t,e){Error.stackTraceLimit=Error.stackTraceLimit+6,r(t,e),Error.stackTraceLimit=Error.stackTraceLimit-6}}var n=new Error;if("string"==typeof n.stack&&n.stack.split("\n")[0].indexOf("stackDetection@")>=0)return A=/@/,D=e,V=!0,function(t){t.stack=(new Error).stack};var i;try{throw new Error}catch(o){i="stack"in o}return"stack"in n||!i?(D=function(t,e){return"string"==typeof t?t:"object"!=typeof e&&"function"!=typeof e||void 0===e.name||void 0===e.message?m(e):e.toString()},null):(A=t,D=e,function(t){Error.stackTraceLimit=Error.stackTraceLimit+6;try{throw new Error}catch(e){t.stack=e.stack}Error.stackTraceLimit=Error.stackTraceLimit-6})}([]),M=function(){if(P.isNode)return function(t,e,r){return"rejectionHandled"===t?process.emit(t,r):process.emit(t,e,r)};var t=!1,e=!0;try{var r=new self.CustomEvent("test");t=r instanceof CustomEvent}catch(n){}if(!t)try{var i=document.createEvent("CustomEvent");i.initCustomEvent("testingtheevent",!1,!0,{}),self.dispatchEvent(i)}catch(n){e=!1}e&&(Q=function(e,r){var n;return t?n=new self.CustomEvent(e,{detail:r,bubbles:!1,cancelable:!0}):self.dispatchEvent&&(n=document.createEvent("CustomEvent"),n.initCustomEvent(e,!1,!0,r)),n?!self.dispatchEvent(n):!1});var o={};return o.unhandledRejection="onunhandledRejection".toLowerCase(),o.rejectionHandled="onrejectionHandled".toLowerCase(),function(t,e,r){var n=o[t],i=self[n];return i?("rejectionHandled"===t?i.call(self,r):i.call(self,e,r),!0):!1}}();"undefined"!=typeof console&&"undefined"!=typeof console.warn&&(x=function(t){console.warn(t)},P.isNode&&process.stderr.isTTY?x=function(t,e){var r=e?"[33m":"[31m";process.stderr.write(r+t+"[0m\n")}:P.isNode||"string"!=typeof(new Error).stack||(x=function(t,e){console.warn("%c"+t,e?"color: darkorange":"color: red")}));var q={warnings:I,longStackTraces:!1,cancellation:!1};return U&&e.longStackTraces(),{longStackTraces:function(){return q.longStackTraces},warnings:function(){return q.warnings},cancellation:function(){return q.cancellation},propagateFromFunction:function(){return H},checkForgottenReturns:c,setBounds:C,warn:l,deprecated:u,CapturedTrace:k}}},{"./errors.js":12,"./util.js":36}],10:[function(t,e){"use strict";e.exports=function(e){function r(){return i?this:this.value}function n(){throw i?this:this.reason}var i=t("./es5.js").isES5;e.prototype["return"]=e.prototype.thenReturn=function(t){return i||(t={value:t}),this._then(r,void 0,void 0,t,void 0)},e.prototype["throw"]=e.prototype.thenThrow=function(t){return i||(t={reason:t}),this._then(n,void 0,void 0,t,void 0)},e.prototype.catchThrow=function(t){if(1===arguments.length)return i||(t={reason:t}),this._then(void 0,n,void 0,t,void 0);var e=arguments[1],r=function(){throw e};return this.caught(t,r)},e.prototype.catchReturn=function(t){if(1===arguments.length)return i||(t={value:t}),this._then(void 0,r,void 0,t,void 0);var e=arguments[1],n=function(){return e};return this.caught(t,n)}}},{"./es5.js":13}],11:[function(t,e){"use strict";e.exports=function(t,e){var r=t.reduce;t.prototype.mapSeries=t.prototype.each=function(t){return r(this,t,e,e)},t.mapSeries=t.each=function(t,n){return r(t,n,e,e)}}},{}],12:[function(t,e){"use strict";function r(t,e){function r(n){return this instanceof r?(l(this,"message","string"==typeof n?n:e),l(this,"name",t),void(Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):Error.call(this))):new r(n)}return u(r,Error),r}function n(t){return this instanceof n?(l(this,"name","OperationalError"),l(this,"message",t),this.cause=t,this.isOperational=!0,void(t instanceof Error?(l(this,"message",t.message),l(this,"stack",t.stack)):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor))):new n(t)}var i,o,s=t("./es5.js"),a=s.freeze,c=t("./util.js"),u=c.inherits,l=c.notEnumerableProp,h=r("Warning","warning"),p=r("CancellationError","cancellation error"),f=r("TimeoutError","timeout error"),_=r("AggregateError","aggregate error");try{i=TypeError,o=RangeError}catch(d){i=r("TypeError","type error"),o=r("RangeError","range error")}for(var v="join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse".split(" "),y=0;y<v.length;++y)"function"==typeof Array.prototype[v[y]]&&(_.prototype[v[y]]=Array.prototype[v[y]]);s.defineProperty(_.prototype,"length",{value:0,configurable:!1,writable:!0,enumerable:!0}),_.prototype.isOperational=!0;var g=0;_.prototype.toString=function(){var t=Array(4*g+1).join(" "),e="\n"+t+"AggregateError of:\n";g++,t=Array(4*g+1).join(" ");for(var r=0;r<this.length;++r){for(var n=this[r]===this?"[Circular AggregateError]":this[r]+"",i=n.split("\n"),o=0;o<i.length;++o)i[o]=t+i[o];n=i.join("\n"),e+=n+"\n"}return g--,e},u(n,Error);var m=Error.__BluebirdErrorTypes__;m||(m=a({CancellationError:p,TimeoutError:f,OperationalError:n,RejectionError:n,AggregateError:_}),l(Error,"__BluebirdErrorTypes__",m)),e.exports={Error:Error,TypeError:i,RangeError:o,CancellationError:m.CancellationError,OperationalError:m.OperationalError,TimeoutError:m.TimeoutError,AggregateError:m.AggregateError,Warning:h}},{"./es5.js":13,"./util.js":36}],13:[function(t,e){var r=function(){"use strict";return void 0===this}();if(r)e.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,getDescriptor:Object.getOwnPropertyDescriptor,keys:Object.keys,names:Object.getOwnPropertyNames,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:r,propertyIsWritable:function(t,e){var r=Object.getOwnPropertyDescriptor(t,e);return!(r&&!r.writable&&!r.set)}};else{var n={}.hasOwnProperty,i={}.toString,o={}.constructor.prototype,s=function(t){var e=[];for(var r in t)n.call(t,r)&&e.push(r);return e},a=function(t,e){return{value:t[e]}},c=function(t,e,r){return t[e]=r.value,t},u=function(t){return t},l=function(t){try{return Object(t).constructor.prototype}catch(e){return o}},h=function(t){try{return"[object Array]"===i.call(t)}catch(e){return!1}};e.exports={isArray:h,keys:s,names:s,defineProperty:c,getDescriptor:a,freeze:u,getPrototypeOf:l,isES5:r,propertyIsWritable:function(){return!0}}}},{}],14:[function(t,e){"use strict";e.exports=function(t,e){var r=t.map;t.prototype.filter=function(t,n){return r(this,t,n,e)},t.filter=function(t,n,i){return r(t,n,i,e)}}},{}],15:[function(t,e){"use strict";e.exports=function(e,r){function n(t,e){return null!=t.cancelPromise?(arguments.length>1?t.cancelPromise._reject(e):t.cancelPromise._cancel(),t.cancelPromise=null,!0):!1}function i(){return s.call(this,this.promise._target()._settledValue())}function o(t){return n(this,t)?void 0:(c.e=t,c)}function s(t){var s=this.promise,a=this.handler;if(!this.called){this.called=!0;var u=a.call(s._boundTo);if(void 0!==u){var l=r(u,s);if(l instanceof e){if(null!=this.cancelPromise)if(l.isCancelled())n(this);else if(l.isPending()){var h=this,p=l._onCancel();l._setOnCancel(function(){n(h),l._invokeOnCancel(p)})}return l._then(i,o,void 0,this,void 0)}}}return s.isRejected()?(n(this),c.e=t,c):(n(this),t)}var a=t("./util.js"),c=a.errorObj;return e.prototype._passThrough=function(t,e,r){return"function"!=typeof t?this.then():this._then(e,r,void 0,{promise:this,handler:t,called:!1,cancelPromise:null},void 0)},e.prototype.lastly=e.prototype["finally"]=function(t){return this._passThrough(t,s,s)},e.prototype.tap=function(t){return this._passThrough(t,s)},s}},{"./util.js":36}],16:[function(t,e){"use strict";e.exports=function(e,r,n,i){function o(t,r,n){for(var o=0;o<r.length;++o){n._pushContext();var s=h(r[o])(t);if(n._popContext(),s===l){n._pushContext();var a=e.reject(l.e);return n._popContext(),a}var c=i(s,n);if(c instanceof e)return c}return null}function s(t,r,i,o){var s=this._promise=new e(n);s._captureStackTrace(),this._stack=o,this._generatorFunction=t,this._receiver=r,this._generator=void 0,this._yieldHandlers="function"==typeof i?[i].concat(p):p}var a=t("./errors.js"),c=a.TypeError,u=t("./util.js"),l=u.errorObj,h=u.tryCatch,p=[];s.prototype.promise=function(){return this._promise},s.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._next(void 0)},s.prototype._continue=function(t){if(t===l)return this._promise._rejectCallback(t.e,!1);var r=t.value;if(t.done===!0)this._promise._resolveCallback(r);else{var n=i(r,this._promise);if(!(n instanceof e)&&(n=o(n,this._yieldHandlers,this._promise),null===n))return void this._throw(new c("A value %s was yielded that could not be treated as a promise\n\n    See http://goo.gl/4Y4pDk\n\n".replace("%s",r)+"From coroutine:\n"+this._stack.split("\n").slice(1,-7).join("\n")));n._then(this._next,this._throw,void 0,this,null)}},s.prototype._throw=function(t){this._promise._attachExtraTrace(t),this._promise._pushContext();var e=h(this._generator["throw"]).call(this._generator,t);this._promise._popContext(),this._continue(e)},s.prototype._next=function(t){this._promise._pushContext();var e=h(this._generator.next).call(this._generator,t);this._promise._popContext(),this._continue(e)},e.coroutine=function(t,e){if("function"!=typeof t)throw new c("generatorFunction must be a function\n\n    See http://goo.gl/6Vqhm0\n");var r=Object(e).yieldHandler,n=s,i=(new Error).stack;return function(){var e=t.apply(this,arguments),o=new n(void 0,void 0,r,i);return o._generator=e,o._next(void 0),o.promise()}},e.coroutine.addYieldHandler=function(t){if("function"!=typeof t)throw new c("expecting a function but got "+u.classString(t));p.push(t)},e.spawn=function(t){if("function"!=typeof t)return r("generatorFunction must be a function\n\n    See http://goo.gl/6Vqhm0\n");var n=new s(t,this),i=n.promise();return n._run(e.spawn),i}}},{"./errors.js":12,"./util.js":36}],17:[function(t,e){"use strict";e.exports=function(e,r,n,i,o){{var s=t("./util.js");s.canEvaluate,s.tryCatch,s.errorObj}e.join=function(){var t,e=arguments.length-1;if(e>0&&"function"==typeof arguments[e]){t=arguments[e];var n}var i=[].slice.call(arguments);t&&i.pop();var n=new r(i).promise();return void 0!==t?n.spread(t):n}}},{"./util.js":36}],18:[function(t,e){"use strict";e.exports=function(e,r,n,i,o,s){function a(t,e,r,n){this.constructor$(t),this._promise._captureStackTrace(),this._callback=e,this._preservedValues=n===o?new Array(this.length()):null,this._limit=r,this._inFlight=0,this._queue=r>=1?[]:p,this._init$(void 0,-2)}function c(t,e,r,i){if("function"!=typeof e)return n("expecting a function but got "+u.classString(e));var o="object"==typeof r&&null!==r?r.concurrency:0;return o="number"==typeof o&&isFinite(o)&&o>=1?o:0,new a(t,e,o,i).promise()}var u=t("./util.js"),l=u.tryCatch,h=u.errorObj,p=[];u.inherits(a,r),a.prototype._init=function(){},a.prototype._promiseFulfilled=function(t,r){var n=this._values,o=this.length(),a=this._preservedValues,c=this._limit;if(0>r){if(r=-1*r-1,n[r]=t,c>=1&&(this._inFlight--,this._drainQueue(),this._isResolved()))return}else{if(c>=1&&this._inFlight>=c)return n[r]=t,void this._queue.push(r);null!==a&&(a[r]=t);var u=this._promise,p=this._callback,f=u._boundTo;u._pushContext();var _=l(p).call(f,t,r,o),d=u._popContext();if(s.checkForgottenReturns(_,d,null!==a?"Promise.filter":"Promise.map",u),_===h)return this._reject(_.e);var v=i(_,this._promise);if(v instanceof e){v=v._target();var y=v._bitField;if(0===(50397184&y))return c>=1&&this._inFlight++,n[r]=v,v._proxyPromiseArray(this,-1*(r+1));if(0===(33554432&y))return 0!==(16777216&y)?this._reject(v._reason()):this._cancel();_=v._value()}n[r]=_}var g=++this._totalResolved;g>=o&&(null!==a?this._filter(n,a):this._resolve(n))},a.prototype._drainQueue=function(){for(var t=this._queue,e=this._limit,r=this._values;t.length>0&&this._inFlight<e;){if(this._isResolved())return;var n=t.pop();this._promiseFulfilled(r[n],n)}},a.prototype._filter=function(t,e){for(var r=e.length,n=new Array(r),i=0,o=0;r>o;++o)t[o]&&(n[i++]=e[o]);n.length=i,this._resolve(n)},a.prototype.preservedValues=function(){return this._preservedValues},e.prototype.map=function(t,e){return c(this,t,e,null)},e.map=function(t,e,r,n){return c(t,e,r,n)}}},{"./util.js":36}],19:[function(t,e){"use strict";e.exports=function(e,r,n,i,o){var s=t("./util.js"),a=s.tryCatch;e.method=function(t){if("function"!=typeof t)throw new e.TypeError("expecting a function but got "+s.classString(t));return function(){var n=new e(r);n._captureStackTrace(),n._pushContext();var i=a(t).apply(this,arguments);return n._popContext(),n._resolveFromSyncValue(i),n}},e.attempt=e["try"]=function(t){if("function"!=typeof t)return i("expecting a function but got "+s.classString(t));var n=new e(r);n._captureStackTrace(),n._pushContext();var c;if(arguments.length>1){o.deprecated("calling Promise.try with more than 1 argument");var u=arguments[1],l=arguments[2];c=s.isArray(u)?a(t).apply(l,u):a(t).call(l,u)}else c=a(t)();return n._popContext(),n._resolveFromSyncValue(c),n},e.prototype._resolveFromSyncValue=function(t){t===s.errorObj?this._rejectCallback(t.e,!1):this._resolveCallback(t,!0)}}},{"./util.js":36}],20:[function(t,e){"use strict";function r(t){return t instanceof Error&&u.getPrototypeOf(t)===Error.prototype}function n(t){var e;if(r(t)){e=new c(t),e.name=t.name,e.message=t.message,e.stack=t.stack;for(var n=u.keys(t),i=0;i<n.length;++i){var s=n[i];l.test(s)||(e[s]=t[s])}return e}return o.markAsOriginatingFromRejection(t),t}function i(t,e){return function(r,i){if(null!==t){if(r){var o=n(s(r));t._attachExtraTrace(o),t._reject(o)}else if(e){var a=[].slice.call(arguments,1);t._fulfill(a)}else t._fulfill(i);t=null}}}var o=t("./util.js"),s=o.maybeWrapAsError,a=t("./errors.js"),c=a.OperationalError,u=t("./es5.js"),l=/^(?:name|message|stack|cause)$/;e.exports=i},{"./errors.js":12,"./es5.js":13,"./util.js":36}],21:[function(t,e){"use strict";e.exports=function(e){function r(t,e){var r=this;if(!o.isArray(t))return n.call(r,t,e);var i=a(e).apply(r._boundTo,[null].concat(t));i===c&&s.throwLater(i.e)}function n(t,e){var r=this,n=r._boundTo,i=void 0===t?a(e).call(n,null):a(e).call(n,null,t);i===c&&s.throwLater(i.e)}function i(t,e){var r=this;if(!t){var n=new Error(t+"");n.cause=t,t=n}var i=a(e).call(r._boundTo,t);i===c&&s.throwLater(i.e)}var o=t("./util.js"),s=e._async,a=o.tryCatch,c=o.errorObj;e.prototype.nodeify=function(t,e){if("function"==typeof t){var o=n;void 0!==e&&Object(e).spread&&(o=r),this._then(o,i,void 0,this,t)}return this}}},{"./util.js":36}],22:[function(t,e){"use strict";e.exports=function(){function e(t,e){if("function"!=typeof e)throw new _("expecting a function but got "+u.classString(e));if(t.constructor!==r)throw new _("the promise constructor cannot be invoked directly\n\n    See http://goo.gl/KsIlge\n")}function r(t){this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,t!==d&&(e(this,t),this._resolveFromExecutor(t)),this._promiseCreated()}function n(t){this.promise._resolveCallback(t)}function i(t){this.promise._rejectCallback(t,!1)}function o(t){var e=new r(d);e._fulfillmentHandler0=t,e._rejectionHandler0=t,e._promise0=t,e._receiver0=t}var s=function(){return new _("circular promise resolution chain\n\n    See http://goo.gl/LhFpo0\n")},a=function(){return new r.PromiseInspection(this._target())},c=function(t){return r.reject(new _(t))},u=t("./util.js"),l=t("./es5.js"),h=t("./async.js"),p=new h;l.defineProperty(r,"_async",{value:p});var f=t("./errors.js"),_=r.TypeError=f.TypeError;r.RangeError=f.RangeError,r.CancellationError=f.CancellationError,r.TimeoutError=f.TimeoutError,r.OperationalError=f.OperationalError,r.RejectionError=f.OperationalError,r.AggregateError=f.AggregateError;var d=function(){},v={},y={},g=t("./thenables.js")(r,d),m=t("./promise_array.js")(r,d,g,c),j=t("./context.js")(r),b=j.create,w=t("./debuggability.js")(r,j),C=(w.CapturedTrace,t("./finally.js")(r,g)),k=t("./catch_filter.js")(y),E=t("./nodeback.js"),F=u.errorObj,x=u.tryCatch;return r.prototype.toString=function(){return"[object Promise]"},r.prototype.caught=r.prototype["catch"]=function(t){var e=arguments.length;if(e>1){var r,n=new Array(e-1),i=0;for(r=0;e-1>r;++r){var o=arguments[r];if(!u.isObject(o))return c("expecting an object but got "+u.classString(o));n[i++]=o}return n.length=i,t=arguments[r],this.then(void 0,k(n,t,this))}return this.then(void 0,t)},r.prototype.reflect=function(){return this._then(a,a,void 0,this,void 0)},r.prototype.then=function(t,e){if(w.warnings()&&arguments.length>0&&"function"!=typeof t&&"function"!=typeof e){var r=".then() only accepts functions but was passed: "+u.classString(t);
arguments.length>1&&(r+=", "+u.classString(e)),this._warn(r)}return this._then(t,e,void 0,void 0,void 0)},r.prototype.done=function(t,e){var r=this._then(t,e,void 0,void 0,void 0);r._setIsFinal()},r.prototype.spread=function(t){return"function"!=typeof t?c("expecting a function but got "+u.classString(t)):this.all()._then(t,void 0,void 0,v,void 0)},r.prototype.toJSON=function(){var t={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(t.fulfillmentValue=this.value(),t.isFulfilled=!0):this.isRejected()&&(t.rejectionReason=this.reason(),t.isRejected=!0),t},r.prototype.all=function(){return arguments.length>0&&this._warn(".all() was passed arguments but it does not take any"),new m(this).promise()},r.prototype.error=function(t){return this.caught(u.originatesFromRejection,t)},r.is=function(t){return t instanceof r},r.fromNode=function(t,e){var n=new r(d),i=x(t)(E(n,!!e));return i===F&&n._rejectCallback(i.e,!0),n},r.all=function(t){return new m(t).promise()},r.cast=function(t){var e=g(t);if(!(e instanceof r)){var n=e;e=new r(d),e._fulfillUnchecked(n)}return e},r.resolve=r.fulfilled=r.cast,r.reject=r.rejected=function(t){var e=new r(d);return e._captureStackTrace(),e._rejectCallback(t,!0),e},r.setScheduler=function(t){if("function"!=typeof t)throw new _("expecting a function but got "+u.classString(t));var e=p._schedule;return p._schedule=t,e},r.prototype._then=function(t,e,n,i,o){var s=void 0!==o,a=s?o:new r(d);s||(a._propagateFrom(this,3),a._captureStackTrace(),void 0===i&&0!==(2097152&this._bitField)&&(i=this._boundTo));var c=this._target(),u=c._bitField;if(0!==(50397184&u)){var l,h;0!==(16842752&u)?(h=c._fulfillmentHandler0,l=e,c._unsetRejectionIsUnhandled()):(h=c._rejectionHandler0,l=t),p.invoke(c._settlePromiseCtx,c,{handler:l,promise:a,receiver:i,value:h})}else c._addCallbacks(t,e,a,i);return a},r.prototype._length=function(){return 65535&this._bitField},r.prototype._isFateSealed=function(){return 0!==(117506048&this._bitField)},r.prototype._isFollowing=function(){return 67108864===(67108864&this._bitField)},r.prototype._setLength=function(t){this._bitField=-65536&this._bitField|65535&t},r.prototype._setFulfilled=function(){this._bitField=33554432|this._bitField},r.prototype._setRejected=function(){this._bitField=16777216|this._bitField},r.prototype._setFollowing=function(){this._bitField=67108864|this._bitField},r.prototype._setIsFinal=function(){this._bitField=4194304|this._bitField},r.prototype._isFinal=function(){return(4194304&this._bitField)>0},r.prototype._unsetCancelled=function(){this._bitField=-65537&this._bitField},r.prototype._setCancelled=function(){this._bitField=65536|this._bitField},r.prototype._receiverAt=function(t){var e=this[4*t-4+3];return void 0===e&&this._isBound()?this._boundTo:e},r.prototype._promiseAt=function(t){return this[4*t-4+2]},r.prototype._fulfillmentHandlerAt=function(t){return this[4*t-4+0]},r.prototype._rejectionHandlerAt=function(t){return this[4*t-4+1]},r.prototype._migrateCallback0=function(t){var e=t._bitField,r=t._fulfillmentHandler0,n=t._rejectionHandler0,i=t._promise0,o=t._receiver0;0!==(2097152&e)&&void 0===o&&(o=t._boundTo),this._addCallbacks(r,n,i,o)},r.prototype._migrateCallbackAt=function(t,e){var r=t._fulfillmentHandlerAt(e),n=t._rejectionHandlerAt(e),i=t._promiseAt(e),o=t._receiverAt(e);this._addCallbacks(r,n,i,o)},r.prototype._addCallbacks=function(t,e,r,n){var i=this._length();if(i>=65531&&(i=0,this._setLength(0)),0===i)this._promise0=r,void 0!==n&&(this._receiver0=n),"function"==typeof t&&(this._fulfillmentHandler0=t),"function"==typeof e&&(this._rejectionHandler0=e);else{var o=4*i-4;this[o+2]=r,this[o+3]=n,"function"==typeof t&&(this[o+0]=t),"function"==typeof e&&(this[o+1]=e)}return this._setLength(i+1),i},r.prototype._proxyPromiseArray=function(t,e){this._addCallbacks(void 0,void 0,e,t)},r.prototype._resolveCallback=function(t,e){if(0===(117506048&this._bitField)){if(t===this)return this._rejectCallback(s(),!1);var n=g(t,this);if(!(n instanceof r))return this._fulfill(t);e&&this._propagateFrom(n,2);var i=n._target(),o=i._bitField;if(0===(50397184&o)){var a=this._length();a>0&&i._migrateCallback0(this);for(var c=1;a>c;++c)i._migrateCallbackAt(this,c);this._setFollowing(),this._setLength(0),this._setFollowee(i),void 0!==this._onCancel()&&(i._attachCancellationCallback(this._onCancel(),this),this._unsetOnCancel())}else 0!==(33554432&o)?this._fulfillUnchecked(i._value()):0!==(16777216&o)?this._rejectUnchecked(i._reason()):this._cancel()}},r.prototype._rejectCallback=function(t,e){var r=u.ensureErrorObject(t),n=r===t;if(!n&&w.warnings()){var i="a promise was rejected with a non-error: "+u.classString(t);this._warn(i,!0)}this._attachExtraTrace(r,e?n:!1),this._reject(t)},r.prototype._execute=function(t,e,r){try{t(e,r)}catch(n){return n}},r.prototype._resolveFromExecutor=function(t){var e=this;this._captureStackTrace(),this._pushContext();var r=!0,n=this._execute(t,function(t){e._resolveCallback(t)},function(t){e._rejectCallback(t,r)});r=!1,this._popContext(),void 0!==n&&e._rejectCallback(n,!0)},r.prototype._settlePromiseFromHandler=function(t,e,r,n){var i=n._bitField;if(0!==(16842752&i)){if(0!==(16777216&i))return;n._unsetCancelled()}n._pushContext();var o;e===v?r&&"number"==typeof r.length?o=x(t).apply(this._boundTo,r):(o=F,o.e=new _("cannot .spread() a non-array: "+u.classString(r))):o=x(t).call(e,r);var a=n._popContext();if(o===y)n._reject(r);else if(o===F||o===n){var c=o===n?s():o.e;n._rejectCallback(c,!1)}else void 0===o&&a>0&&w.longStackTraces()&&w.warnings()&&n._warn("a promise was created in a handler but none were returned from it",!0),n._resolveCallback(o)},r.prototype._target=function(){for(var t=this;t._isFollowing();)t=t._followee();return t},r.prototype._followee=function(){return this._rejectionHandler0},r.prototype._setFollowee=function(t){this._rejectionHandler0=t},r.prototype._fulfill=function(t){this._isFateSealed()||this._fulfillUnchecked(t)},r.prototype._reject=function(t){this._isFateSealed()||this._rejectUnchecked(t)},r.prototype._settlePromise=function(t,e,n,i){var o=t instanceof r,s=this._bitField;0!==(65536&s)?(o&&t.isCancellable()&&void 0!==t._onCancel()&&t._invokeOnCancel(t._onCancel()),e===C?(n.cancelPromise=t,x(e).call(n,i)===F&&t._reject(F.e)):n instanceof m?n._promiseCancelled(t):o||t instanceof m?t._cancel():n.cancel()):"function"==typeof e?o?this._settlePromiseFromHandler(e,n,i,t):e.call(n,i,t):n instanceof m?n._isResolved()||(0!==(33554432&s)?n._promiseFulfilled(i,t):n._promiseRejected(i,t)):o&&(0!==(33554432&s)?t._fulfill(i):t._reject(i))},r.prototype._settlePromiseCtx=function(t){this._settlePromise(t.promise,t.handler,t.receiver,t.value)},r.prototype._settlePromise0=function(t,e,r){var n=this._promise0,i=this._receiver0;void 0===i?0!==(2097152&r)&&(i=this._boundTo):this._receiver0=void 0,this._promise0=void 0,this._settlePromise(n,t,i,e)},r.prototype._clearCallbackDataAtIndex=function(t){var e=4*t-4;this[e+2]=this[e+3]=this[e+0]=this[e+1]=void 0},r.prototype._fulfillUnchecked=function(t){if(t===this){var e=s();return this._attachExtraTrace(e),this._rejectUnchecked(e)}this._setFulfilled(),this._rejectionHandler0=t,this._cleanValues(),this._length()>0&&p.settlePromises(this)},r.prototype._rejectUnchecked=function(t){return this._setRejected(),this._fulfillmentHandler0=t,this._cleanValues(),this._isFinal()?p.fatalError(t,u.isNode):void(this._length()>0?p.settlePromises(this):this._ensurePossibleRejectionHandled())},r.prototype._fulfillPromises=function(t,e){for(var r=1;t>r;r++){var n=this._fulfillmentHandlerAt(r),i=this._promiseAt(r),o=this._receiverAt(r);this._clearCallbackDataAtIndex(r),this._settlePromise(i,n,o,e)}},r.prototype._rejectPromises=function(t,e){for(var r=1;t>r;r++){var n=this._rejectionHandlerAt(r),i=this._promiseAt(r),o=this._receiverAt(r);this._clearCallbackDataAtIndex(r),this._settlePromise(i,n,o,e)}},r.prototype._settlePromises=function(){var t=this._bitField,e=65535&t;if(0!==(16842752&t)){var r=this._fulfillmentHandler0;this._settlePromise0(this._rejectionHandler0,r,t),this._rejectPromises(e,r)}else{var n=this._rejectionHandler0;this._settlePromise0(this._fulfillmentHandler0,n,t),this._fulfillPromises(e,n)}this._setLength(0)},r.prototype._settledValue=function(){var t=this._bitField;return 0!==(33554432&t)?this._rejectionHandler0:0!==(16777216&t)?this._fulfillmentHandler0:void 0},r.defer=function(){w.deprecated("Promise.defer","new Promise");var t=new r(d);return{promise:t,resolve:n,reject:i}},r._makeSelfResolutionError=s,t("./method.js")(r,d,g,c),t("./bind.js")(r,d,g,w),t("./direct_resolve.js")(r),t("./synchronous_inspection.js")(r),t("./join.js")(r,m,g,d,w),r.Promise=r,t("./map.js")(r,m,c,g,d,w),t("./cancel.js")(r,c,w),t("./using.js")(r,c,g,b,d,w),t("./generators.js")(r,c,d,g),t("./nodeify.js")(r),t("./call_get.js")(r),t("./props.js")(r,m,g,c),t("./race.js")(r,d,g,c),t("./reduce.js")(r,m,c,g,d,w),t("./settle.js")(r,m,w),t("./some.js")(r,m,c),t("./promisify.js")(r,d),t("./any.js")(r),t("./each.js")(r,d),t("./timers.js")(r,d),t("./filter.js")(r,d),u.toFastProperties(r),u.toFastProperties(r.prototype),o({a:1}),o({b:2}),o({c:3}),o(1),o(function(){}),o(void 0),o(!1),o(new r(d)),w.setBounds(h.firstLineError,u.lastLineError),r}},{"./any.js":1,"./async.js":2,"./bind.js":3,"./call_get.js":5,"./cancel.js":6,"./catch_filter.js":7,"./context.js":8,"./debuggability.js":9,"./direct_resolve.js":10,"./each.js":11,"./errors.js":12,"./es5.js":13,"./filter.js":14,"./finally.js":15,"./generators.js":16,"./join.js":17,"./map.js":18,"./method.js":19,"./nodeback.js":20,"./nodeify.js":21,"./promise_array.js":23,"./promisify.js":24,"./props.js":25,"./race.js":27,"./reduce.js":28,"./settle.js":30,"./some.js":31,"./synchronous_inspection.js":32,"./thenables.js":33,"./timers.js":34,"./using.js":35,"./util.js":36}],23:[function(t,e){"use strict";e.exports=function(e,r,n,i){function o(t){switch(t){case-2:return[];case-3:return{}}}function s(t){var n=this._promise=new e(r);t instanceof e&&n._propagateFrom(t,3),n._setOnCancel(this),this._values=t,this._length=0,this._totalResolved=0,this._init(void 0,-2)}var a=t("./util.js"),c=a.isArray;return s.prototype.length=function(){return this._length},s.prototype.promise=function(){return this._promise},s.prototype._init=function u(t,r){var s=n(this._values,this._promise);if(s instanceof e){s=s._target();var l=s._bitField;if(this._values=s,0===(50397184&l))return s._then(u,this._reject,void 0,this,r);if(0===(33554432&l))return 0!==(16777216&l)?this._reject(s._reason()):this._cancel();s=s._value()}if(!c(s)){var h=i("expecting an array but got "+a.classString(s)).reason();return void this._promise._rejectCallback(h,!1)}return 0===s.length?void(-5===r?this._resolveEmptyArray():this._resolve(o(r))):void this._iterate(s)},s.prototype._iterate=function(t){var r=this.getActualLength(t.length);this._length=r,this._values=this.shouldCopyValues()?new Array(r):this._values;for(var i=this._promise,o=0;r>o;++o){var s=this._isResolved(),a=n(t[o],i);if(a instanceof e){a=a._target();var c=a._bitField;0===(50397184&c)?(a._proxyPromiseArray(this,o),this._values[o]=a):s?a._unsetRejectionIsUnhandled():0!==(33554432&c)?this._promiseFulfilled(a._value(),o):0!==(16777216&c)?this._promiseRejected(a._reason(),o):this._promiseCancelled(o)}else s||this._promiseFulfilled(a,o)}},s.prototype._isResolved=function(){return null===this._values},s.prototype._resolve=function(t){this._values=null,this._promise._fulfill(t)},s.prototype._cancel=function(){!this._isResolved()&&this._promise.isCancellable()&&(this._values=null,this._promise._cancel())},s.prototype._reject=function(t){this._values=null,this._promise._rejectCallback(t,!1)},s.prototype._promiseFulfilled=function(t,e){this._values[e]=t;var r=++this._totalResolved;r>=this._length&&this._resolve(this._values)},s.prototype._promiseCancelled=function(){this._cancel()},s.prototype._promiseRejected=function(t){this._totalResolved++,this._reject(t)},s.prototype._resultCancelled=function(){if(!this._isResolved()){var t=this._values;if(this._cancel(),t instanceof e)t.cancel();else for(var r=0;r<t.length;++r)t[r]instanceof e&&t[r].cancel()}},s.prototype.shouldCopyValues=function(){return!0},s.prototype.getActualLength=function(t){return t},s}},{"./util.js":36}],24:[function(t,e){"use strict";e.exports=function(e,r){function n(t){return!b.test(t)}function i(t){try{return t.__isPromisified__===!0}catch(e){return!1}}function o(t,e,r){var n=f.getDataPropertyOrDefault(t,e+r,j);return n?i(n):!1}function s(t,e,r){for(var n=0;n<t.length;n+=2){var i=t[n];if(r.test(i))for(var o=i.replace(r,""),s=0;s<t.length;s+=2)if(t[s]===o)throw new g("Cannot promisify an API that has normal methods with '%s'-suffix\n\n    See http://goo.gl/iWrZbw\n".replace("%s",e))}}function a(t,e,r,n){for(var a=f.inheritedDataKeys(t),c=[],u=0;u<a.length;++u){var l=a[u],h=t[l],p=n===w?!0:w(l,h,t);"function"!=typeof h||i(h)||o(t,l,e)||!n(l,h,t,p)||c.push(l,h)}return s(c,e,r),c}function c(t,n,i,o,s,a){function c(){var i=n;n===p&&(i=this);var o=new e(r);o._captureStackTrace();var s="string"==typeof l&&this!==u?this[l]:t,c=_(o,a);try{s.apply(i,d(arguments,c))}catch(h){o._rejectCallback(v(h),!0)}return o}var u=function(){return this}(),l=t;return"string"==typeof l&&(t=o),c.__isPromisified__=!0,c}function u(t,e,r,n,i){for(var o=new RegExp(C(e)+"$"),s=a(t,e,o,r),c=0,u=s.length;u>c;c+=2){var l=s[c],h=s[c+1],_=l+e;t[_]=n===k?k(l,p,l,h,e,i):n(h,function(){return k(l,p,l,h,e,i)})}return f.toFastProperties(t),t}function l(t,e,r){return k(t,e,void 0,t,null,r)}var h,p={},f=t("./util.js"),_=t("./nodeback.js"),d=f.withAppended,v=f.maybeWrapAsError,y=f.canEvaluate,g=t("./errors").TypeError,m="Async",j={__isPromisified__:!0},b=/^(?:length|name|arguments|caller|prototype|__isPromisified__)$/,w=function(t,e){return f.isIdentifier(t)&&"_"!==t.charAt(0)&&!f.isClass(e)},C=function(t){return t.replace(/([$])/,"\\$")},k=y?h:c;e.promisify=function(t,e,r){if("function"!=typeof t)throw new g("expecting a function but got "+f.classString(t));if(i(t))return t;var o=l(t,arguments.length<3?p:r,!!e);return f.copyDescriptors(t,o,n),o},e.promisifyAll=function(t,e){if("function"!=typeof t&&"object"!=typeof t)throw new g("the target of promisifyAll must be an object or a function\n\n    See http://goo.gl/9ITlV0\n");e=Object(e);var r=!!e.multiArgs,n=e.suffix;"string"!=typeof n&&(n=m);var i=e.filter;"function"!=typeof i&&(i=w);var o=e.promisifier;if("function"!=typeof o&&(o=k),!f.isIdentifier(n))throw new RangeError("suffix must be a valid identifier\n\n    See http://goo.gl/8FZo5V\n");for(var s=f.inheritedDataKeys(t),a=0;a<s.length;++a){var c=t[s[a]];"constructor"!==s[a]&&f.isClass(c)&&(u(c.prototype,n,i,o,r),u(c,n,i,o,r))}return u(t,n,i,o,r)}}},{"./errors":12,"./nodeback.js":20,"./util.js":36}],25:[function(t,e){"use strict";e.exports=function(e,r,n,i){function o(t){for(var e=u.keys(t),r=e.length,n=new Array(2*r),i=0;r>i;++i){var o=e[i];n[i]=t[o],n[i+r]=o}this.constructor$(n)}function s(t){var r,s=n(t);return c(s)?(r=s instanceof e?s._then(e.props,void 0,void 0,void 0,void 0):new o(s).promise(),s instanceof e&&r._propagateFrom(s,2),r):i("cannot await properties of a non-object\n\n    See http://goo.gl/OsFKC8\n")}var a=t("./util.js"),c=a.isObject,u=t("./es5.js");a.inherits(o,r),o.prototype._init=function(){this._init$(void 0,-3)},o.prototype._promiseFulfilled=function(t,e){this._values[e]=t;var r=++this._totalResolved;if(r>=this._length){for(var n={},i=this.length(),o=0,s=this.length();s>o;++o)n[this._values[o+i]]=this._values[o];this._resolve(n)}},o.prototype.shouldCopyValues=function(){return!1},o.prototype.getActualLength=function(t){return t>>1},e.prototype.props=function(){return s(this)},e.props=function(t){return s(t)}}},{"./es5.js":13,"./util.js":36}],26:[function(t,e){"use strict";function r(t,e,r,n,i){for(var o=0;i>o;++o)r[o+n]=t[o+e],t[o+e]=void 0}function n(t){this._capacity=t,this._length=0,this._front=0}n.prototype._willBeOverCapacity=function(t){return this._capacity<t},n.prototype._pushOne=function(t){var e=this.length();this._checkCapacity(e+1);var r=this._front+e&this._capacity-1;this[r]=t,this._length=e+1},n.prototype._unshiftOne=function(t){var e=this._capacity;this._checkCapacity(this.length()+1);var r=this._front,n=(r-1&e-1^e)-e;this[n]=t,this._front=n,this._length=this.length()+1},n.prototype.unshift=function(t,e,r){this._unshiftOne(r),this._unshiftOne(e),this._unshiftOne(t)},n.prototype.push=function(t,e,r){var n=this.length()+3;if(this._willBeOverCapacity(n))return this._pushOne(t),this._pushOne(e),void this._pushOne(r);var i=this._front+n-3;this._checkCapacity(n);var o=this._capacity-1;this[i+0&o]=t,this[i+1&o]=e,this[i+2&o]=r,this._length=n},n.prototype.shift=function(){var t=this._front,e=this[t];return this[t]=void 0,this._front=t+1&this._capacity-1,this._length--,e},n.prototype.length=function(){return this._length},n.prototype._checkCapacity=function(t){this._capacity<t&&this._resizeTo(this._capacity<<1)},n.prototype._resizeTo=function(t){var e=this._capacity;this._capacity=t;var n=this._front,i=this._length,o=n+i&e-1;r(this,0,this,e,o)},e.exports=n},{}],27:[function(t,e){"use strict";e.exports=function(e,r,n,i){function o(t,o){var c=n(t);if(c instanceof e)return a(c);if(!s.isArray(t))return i("expecting an array but got "+s.classString(t));var u=new e(r);void 0!==o&&u._propagateFrom(o,3);for(var l=u._fulfill,h=u._reject,p=0,f=t.length;f>p;++p){var _=t[p];(void 0!==_||p in t)&&e.cast(_)._then(l,h,void 0,u,null)}return u}var s=t("./util.js"),a=function(t){return t.then(function(e){return o(e,t)})};e.race=function(t){return o(t,void 0)},e.prototype.race=function(){return o(this,void 0)}}},{"./util.js":36}],28:[function(t,e){"use strict";e.exports=function(e,r,n,i,o,s){function a(t,r,n,i){this.constructor$(t),this._fn=r,void 0!==n&&(n=e.resolve(n),n._attachCancellationCallback(this)),this._initialValue=n,this._currentCancellable=null,this._eachValues=i===o?[]:void 0,this._promise._captureStackTrace(),this._init$(void 0,-5)}function c(t,e){this.isFulfilled()?e._resolve(t):e._reject(t)}function u(t,e,r,i){if("function"!=typeof e)return n("expecting a function but got "+p.classString(e));var o=new a(t,e,r,i);return o.promise()}function l(t){this.accum=t,this.array._gotAccum(t);var r=i(this.value,this.array._promise);return r instanceof e?(this.array._currentCancellable=r,r._then(h,void 0,void 0,this,void 0)):h.call(this,r)}function h(t){var r=this.array,n=r._promise,i=f(r._fn);n._pushContext();var o;o=void 0!==r._eachValues?i.call(n._boundTo,t,this.index,this.length):i.call(n._boundTo,this.accum,t,this.index,this.length),o instanceof e&&(r._currentCancellable=o);var a=n._popContext();return s.checkForgottenReturns(o,a,void 0!==r._eachValues?"Promise.each":"Promise.reduce",n),o}var p=t("./util.js"),f=p.tryCatch;p.inherits(a,r),a.prototype._gotAccum=function(t){void 0!==this._eachValues&&t!==o&&this._eachValues.push(t)},a.prototype._eachComplete=function(t){return this._eachValues.push(t),this._eachValues},a.prototype._init=function(){},a.prototype._resolveEmptyArray=function(){this._resolve(this._initialValue===o?[]:this._initialValue)},a.prototype.shouldCopyValues=function(){return!1},a.prototype._resolve=function(t){this._promise._resolveCallback(t),this._values=null},a.prototype._resultCancelled=function(t){return t===this._initialValue?this._cancel():void(this._isResolved()||(this._resultCancelled$(),this._currentCancellable instanceof e&&this._currentCancellable.cancel(),this._initialValue instanceof e&&this._initialValue.cancel()))},a.prototype._iterate=function(t){this._values=t;var r,n,i=t.length;if(void 0!==this._initialValue?(r=this._initialValue,n=0):(r=e.resolve(t[0]),n=1),this._currentCancellable=r,!r.isRejected())for(;i>n;++n){var o={accum:null,value:t[n],index:n,length:i,array:this};r=r._then(l,void 0,void 0,o,void 0)}void 0!==this._eachValues&&(r=r._then(this._eachComplete,void 0,void 0,this,void 0)),r._then(c,c,void 0,r,this)},e.prototype.reduce=function(t,e){return u(this,t,e,null)},e.reduce=function(t,e,r,n){return u(t,e,r,n)}}},{"./util.js":36}],29:[function(t,e){"use strict";var r;if(t("./util.js").isNode){var n=process.versions.node.split(".").map(Number);r=0===n[0]&&n[1]>10||n[0]>0?global.setImmediate:process.nextTick}else"undefined"!=typeof MutationObserver?(r=function(t){var e=document.createElement("div"),r=new MutationObserver(t);return r.observe(e,{attributes:!0}),function(){e.classList.toggle("foo")}},r.isStatic=!0):r="undefined"!=typeof setTimeout?function(t){setTimeout(t,0)}:function(){throw new Error("No async scheduler available\n\n    See http://goo.gl/m3OTXk\n")};e.exports=r},{"./util.js":36}],30:[function(t,e){"use strict";e.exports=function(e,r,n){function i(t){this.constructor$(t)}var o=e.PromiseInspection,s=t("./util.js");s.inherits(i,r),i.prototype._promiseResolved=function(t,e){this._values[t]=e;var r=++this._totalResolved;r>=this._length&&this._resolve(this._values)},i.prototype._promiseFulfilled=function(t,e){var r=new o;r._bitField=33554432,r._settledValueField=t,this._promiseResolved(e,r)},i.prototype._promiseRejected=function(t,e){var r=new o;r._bitField=16777216,r._settledValueField=t,this._promiseResolved(e,r)},e.settle=function(t){return n.deprecated(".settle()",".reflect()"),new i(t).promise()},e.prototype.settle=function(){return e.settle(this)}}},{"./util.js":36}],31:[function(t,e){"use strict";e.exports=function(e,r,n){function i(t){this.constructor$(t),this._howMany=0,this._unwrap=!1,this._initialized=!1}function o(t,e){if((0|e)!==e||0>e)return n("expecting a positive integer\n\n    See http://goo.gl/1wAmHx\n");var r=new i(t),o=r.promise();return r.setHowMany(e),r.init(),o}var s=t("./util.js"),a=t("./errors.js").RangeError,c=t("./errors.js").AggregateError,u=s.isArray,l={};s.inherits(i,r),i.prototype._init=function(){if(this._initialized){if(0===this._howMany)return void this._resolve([]);this._init$(void 0,-5);var t=u(this._values);!this._isResolved()&&t&&this._howMany>this._canPossiblyFulfill()&&this._reject(this._getRangeError(this.length()))}},i.prototype.init=function(){this._initialized=!0,this._init()},i.prototype.setUnwrap=function(){this._unwrap=!0},i.prototype.howMany=function(){return this._howMany},i.prototype.setHowMany=function(t){this._howMany=t},i.prototype._promiseFulfilled=function(t){this._addFulfilled(t),this._fulfilled()===this.howMany()&&(this._values.length=this.howMany(),this._resolve(1===this.howMany()&&this._unwrap?this._values[0]:this._values))},i.prototype._promiseRejected=function(t){this._addRejected(t),this._checkOutcome()},i.prototype._promiseCancelled=function(){return this._values instanceof e||null==this._values?this._cancel():(this._addRejected(l),void this._checkOutcome())},i.prototype._checkOutcome=function(){if(this.howMany()>this._canPossiblyFulfill()){for(var t=new c,e=this.length();e<this._values.length;++e)this._values[e]!==l&&t.push(this._values[e]);t.length>0?this._reject(t):this._cancel()}},i.prototype._fulfilled=function(){return this._totalResolved},i.prototype._rejected=function(){return this._values.length-this.length()},i.prototype._addRejected=function(t){this._values.push(t)},i.prototype._addFulfilled=function(t){this._values[this._totalResolved++]=t},i.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},i.prototype._getRangeError=function(t){var e="Input array must contain at least "+this._howMany+" items but contains only "+t+" items";return new a(e)},i.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))},e.some=function(t,e){return o(t,e)},e.prototype.some=function(t){return o(this,t)},e._SomePromiseArray=i}},{"./errors.js":12,"./util.js":36}],32:[function(t,e){"use strict";e.exports=function(t){function e(t){void 0!==t?(t=t._target(),this._bitField=t._bitField,this._settledValueField=t._isFateSealed()?t._settledValue():void 0):(this._bitField=0,this._settledValueField=void 0)}e.prototype._settledValue=function(){return this._settledValueField};var r=e.prototype.value=function(){if(!this.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/hc1DLj\n");return this._settledValue()},n=e.prototype.error=e.prototype.reason=function(){if(!this.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/hPuiwB\n");return this._settledValue()},i=e.prototype.isFulfilled=function(){return 0!==(33554432&this._bitField)},o=e.prototype.isRejected=function(){return 0!==(16777216&this._bitField)},s=e.prototype.isPending=function(){return 0===(50331648&this._bitField)},a=e.prototype.isResolved=function(){return 0!==(50331648&this._bitField)};e.prototype.isCancelled=t.prototype._isCancelled=function(){return 65536===(65536&this._bitField)},t.prototype.isCancelled=function(){return this._target()._isCancelled()},t.prototype.isPending=function(){return s.call(this._target())},t.prototype.isRejected=function(){return o.call(this._target())},t.prototype.isFulfilled=function(){return i.call(this._target())},t.prototype.isResolved=function(){return a.call(this._target())},t.prototype.value=function(){return r.call(this._target())},t.prototype.reason=function(){var t=this._target();return t._unsetRejectionIsUnhandled(),n.call(t)},t.prototype._value=function(){return this._settledValue()},t.prototype._reason=function(){return this._unsetRejectionIsUnhandled(),this._settledValue()},t.PromiseInspection=e}},{}],33:[function(t,e){"use strict";e.exports=function(e,r){function n(t,n){if(l(t)){if(t instanceof e)return t;var i=o(t);if(i===u){n&&n._pushContext();var c=e.reject(i.e);return n&&n._popContext(),c}if("function"==typeof i){if(s(t)){var c=new e(r);return t._then(c._fulfillUnchecked,c._rejectUnchecked,void 0,c,null),c}return a(t,i,n)}}return t}function i(t){return t.then}function o(t){try{return i(t)}catch(e){return u.e=e,u}}function s(t){return h.call(t,"_promise0")}function a(t,n,i){function o(r){a&&(t===r?a._rejectCallback(e._makeSelfResolutionError(),!1,!0):a._resolveCallback(r),a=null)}function s(t){a&&(a._rejectCallback(t,h),a=null)}var a=new e(r),l=a;i&&i._pushContext(),a._captureStackTrace(),i&&i._popContext();var h=!0,p=c.tryCatch(n).call(t,o,s);return h=!1,a&&p===u&&(a._rejectCallback(p.e,!0),a=null),l}var c=t("./util.js"),u=c.errorObj,l=c.isObject,h={}.hasOwnProperty;return n}},{"./util.js":36}],34:[function(t,e){"use strict";e.exports=function(e,r){function n(t){var e=this;return e instanceof Number&&(e=+e),clearTimeout(e),t}function i(t){var e=this;throw e instanceof Number&&(e=+e),clearTimeout(e),t}var o=t("./util.js"),s=e.TimeoutError,a=function(t,e){if(t.isPending()){"string"!=typeof e&&(e="operation timed out");var r=new s(e);o.markAsOriginatingFromRejection(r),t._attachExtraTrace(r),t._reject(r)}},c=function(t){return u(+this).thenReturn(t)},u=e.delay=function(t,n){if(void 0!==n)return e.resolve(n)._then(c,null,null,t,void 0);var i=new e(r);return setTimeout(function(){i._fulfill()},+t),i};e.prototype.delay=function(t){return u(t,this)},e.prototype.timeout=function(t,e){t=+t;var r=this.then(),o=setTimeout(function(){a(r,e)},t);return r._then(n,i,void 0,o,void 0)}}},{"./util.js":36}],35:[function(t,e){"use strict";e.exports=function(e,r,n,i,o,s){function a(t){setTimeout(function(){throw t},0)}function c(t){var e=n(t);return e!==t&&"function"==typeof t._isDisposable&&"function"==typeof t._getDisposer&&t._isDisposable()&&e._setDisposable(t._getDisposer()),e}function u(t,r){function i(){if(s>=u)return l._fulfill();var o=c(t[s++]);if(o instanceof e&&o._isDisposable()){try{o=n(o._getDisposer().tryDispose(r),t.promise)}catch(h){return a(h)}if(o instanceof e)return o._then(i,a,null,null,null)}i()}var s=0,u=t.length,l=new e(o);return i(),l}function l(t,e,r){this._data=t,this._promise=e,this._context=r}function h(t,e,r){this.constructor$(t,e,r)}function p(t){return l.isDisposer(t)?(this.resources[this.index]._setDisposable(t),t.promise()):t}var f=t("./util.js"),_=t("./errors.js").TypeError,d=t("./util.js").inherits,v=f.errorObj,y=f.tryCatch;l.prototype.data=function(){return this._data},l.prototype.promise=function(){return this._promise},l.prototype.resource=function(){return this.promise().isFulfilled()?this.promise().value():null},l.prototype.tryDispose=function(t){var e=this.resource(),r=this._context;void 0!==r&&r._pushContext();var n=null!==e?this.doDispose(e,t):null;return void 0!==r&&r._popContext(),this._promise._unsetDisposable(),this._data=null,n},l.isDisposer=function(t){return null!=t&&"function"==typeof t.resource&&"function"==typeof t.tryDispose},d(h,l),h.prototype.doDispose=function(t,e){var r=this.data();return r.call(t,t,e)},e.using=function(){var t=arguments.length;if(2>t)return r("you must pass at least 2 arguments to Promise.using");var i=arguments[t-1];if("function"!=typeof i)return r("expecting a function but got "+f.classString(i));t--;for(var o=new Array(t),a=0;t>a;++a){var c=arguments[a];if(l.isDisposer(c)){var h=c;c=c.promise(),c._setDisposable(h)}else{var _=n(c);_ instanceof e&&(c=_._then(p,null,null,{resources:o,index:a},void 0))}o[a]=c}for(var d=new Array(o.length),a=0;a<d.length;++a)d[a]=e.resolve(o[a]).reflect();var g=e.all(d).then(function(t){for(var e=0;e<t.length;++e){var r=t[e];if(r.isRejected())return v.e=r.error(),v;t[e]=r.value()}m._pushContext();var n=y(i).apply(void 0,t),o=m._popContext();return s.checkForgottenReturns(n,o,"Promise.using",m),n}),m=g.lastly(function(){var t=new e.PromiseInspection(g);return u(o,t)});return o.promise=m,m},e.prototype._setDisposable=function(t){this._bitField=131072|this._bitField,this._disposer=t},e.prototype._isDisposable=function(){return(131072&this._bitField)>0},e.prototype._getDisposer=function(){return this._disposer},e.prototype._unsetDisposable=function(){this._bitField=-131073&this._bitField,this._disposer=void 0},e.prototype.disposer=function(t){if("function"==typeof t)return new h(t,this,i());throw new _}}},{"./errors.js":12,"./util.js":36}],36:[function(t,e,r){"use strict";function n(){try{return F.apply(this,arguments)}catch(t){return E.e=t,E}}function i(t){return F=t,n}function o(t){return null==t||t===!0||t===!1||"string"==typeof t||"number"==typeof t}function s(t){return"function"==typeof t||"object"==typeof t&&null!==t}function a(t){return o(t)?new Error(v(t)):t}function c(t,e){var r,n=t.length,i=new Array(n+1);for(r=0;n>r;++r)i[r]=t[r];return i[r]=e,i}function u(t,e,r){if(!C.isES5)return{}.hasOwnProperty.call(t,e)?t[e]:void 0;var n=Object.getOwnPropertyDescriptor(t,e);return null!=n?null==n.get&&null==n.set?n.value:r:void 0}function l(t,e,r){if(o(t))return t;var n={value:r,configurable:!0,enumerable:!1,writable:!0};return C.defineProperty(t,e,n),t}function h(t){throw t}function p(t){try{if("function"==typeof t){var e=C.names(t.prototype);return C.isES5?e.length>1:e.length>0&&!(1===e.length&&"constructor"===e[0])}return!1}catch(r){return!1}}function f(t){function e(){}return e.prototype=t,new e,t}function _(t){return P.test(t)}function d(t,e,r){for(var n=new Array(t),i=0;t>i;++i)n[i]=e+i+r;return n}function v(t){try{return t+""}catch(e){return"[no string representation]"}}function y(t){try{l(t,"isOperational",!0)}catch(e){}}function g(t){return null==t?!1:t instanceof Error.__BluebirdErrorTypes__.OperationalError||t.isOperational===!0}function m(t){return t instanceof Error&&C.propertyIsWritable(t,"stack")}function j(t){return{}.toString.call(t)}function b(t,e,r){for(var n=C.names(t),i=0;i<n.length;++i){var o=n[i];r(o)&&C.defineProperty(e,o,C.getDescriptor(t,o))}}function w(t,e){return R?process.env[t]:e}var C=t("./es5.js"),k="undefined"==typeof navigator,E={e:{}},F,x=function(t,e){function r(){this.constructor=t,this.constructor$=e;for(var r in e.prototype)n.call(e.prototype,r)&&"$"!==r.charAt(r.length-1)&&(this[r+"$"]=e.prototype[r])}var n={}.hasOwnProperty;return r.prototype=e.prototype,t.prototype=new r,t.prototype},T=function(){return"string"!==this}.call("string"),O=function(){if(C.isES5){var t=Object.prototype,e=Object.getOwnPropertyNames;
return function(r){for(var n=[],i=Object.create(null);null!=r&&r!==t;){var o;try{o=e(r)}catch(s){return n}for(var a=0;a<o.length;++a){var c=o[a];if(!i[c]){i[c]=!0;var u=Object.getOwnPropertyDescriptor(r,c);null!=u&&null==u.get&&null==u.set&&n.push(c)}}r=C.getPrototypeOf(r)}return n}}return function(t){var e=[];for(var r in t)e.push(r);return e}}(),P=/^[a-z$_][a-z$_0-9]*$/i,S=function(){return"stack"in new Error?function(t){return m(t)?t:new Error(v(t))}:function(t){if(m(t))return t;try{throw new Error(v(t))}catch(e){return e}}}(),R="undefined"!=typeof process&&"[object process]"===j(process).toLowerCase(),A={isClass:p,isIdentifier:_,inheritedDataKeys:O,getDataPropertyOrDefault:u,thrower:h,isArray:C.isArray,notEnumerableProp:l,isPrimitive:o,isObject:s,canEvaluate:k,errorObj:E,tryCatch:i,inherits:x,withAppended:c,maybeWrapAsError:a,wrapsPrimitiveReceiver:T,toFastProperties:f,filledRange:d,toString:v,canAttachTrace:m,ensureErrorObject:S,originatesFromRejection:g,markAsOriginatingFromRejection:y,classString:j,copyDescriptors:b,isNode:R,env:w};try{throw new Error}catch(D){A.lastLineError=D}e.exports=A},{"./es5.js":13}]},{},[4])(4)}),"undefined"!=typeof window&&null!==window?window.P=window.Promise:"undefined"!=typeof self&&null!==self&&(self.P=self.Promise);